"use strict";window.shopCart=function(e){var l={el:".shopCart",data:"",classification:!0,openSearch:!0};for(var a in e)l[a]=e[a];var c=document.querySelector(l.el),t="",s="",o=null;l.classification&&(function(e){for(var a=0;a<e.length;a++){for(var n=0;n<e[a].goods.length;n++)s+=' <div class="goods" data-id="'+e[a].goods[n].id+'">\n                    \n                    <input type="checkbox" class="check-i">\n                    <div class="goods-img">\n                        <img src="'+e[a].goods[n].imgURL+'" alt="">\n                    </div>\n                    <div class="goods-introduce">\n                        <p>\n                            '+e[a].goods[n].introduce+'\n                        </p>\n                    </div>\n                    <div class="goods-price">\n                        <p>￥'+e[a].goods[n].price+'</p>\n                    </div>\n                    <div class="goods-count">\n                        <p>\n                            <input type="button" value="-" class="reduce">\n                            <input type="text" value="'+e[a].goods[n].count+'" class="count-num">\n                            <input type="button" value="+" class="add">\n                        </p>\n                    </div>\n                    <div class="goods-sum">\n                        <p>￥'+(e[a].goods[n].price*e[a].goods[n].count).toFixed(1)+'</p>\n                    </div>\n                    <div class="goods-operation">\n                        <a href="###" class="collection">收藏</a>\n                        <a href="###" class="del">删除</a>\n                    </div>\n                </div>';t+=' <div class="shop">\n                <p class="shop-name">\n                    <label>\n                        <input type="checkbox" class="check-shop">\n                        <span></span>\n                        <span>'+e[a].shopName+'</span>\n                    </label>\n                </p>\n                <p class="shop-head">以下商品不支持优惠券使用</p>\n                <div class="goods-list">\n                   '+s+"\n                </div>\n            </div>",s=""}}(l.data),c.innerHTML='\n        <div class="head">\n            <label>\n                <input type="checkbox" class="check-all">\n                <span>全选</span>\n            </label>\n            <span class="goods-sp">商品</span>\n            <span class="price-sp">价格</span>\n            <span class="count-sp">数量</span>\n            <span class="cmp-sp">小计</span>\n            <span class="operation-sp">操作</span>\n        </div>\n\n        <div class="content">\n            '+t+'\n        </div>\n        <div class="settlement">\n            <label>\n                <input type="checkbox" class="check-all">\n                <span>全选</span>\n            </label>\n            <a href="###" class="slm-del">清除</a>\n            <a href="###" class="slm-collection">收藏</a>\n            <div class="pay-box">\n                <div class="pay-count-box">\n                    <span>已选中：</span>\n                    <span class="pay-count">0</span>\n                    <span>&nbsp;件数</span>\n                </div>\n                <div class="pay-price-box">\n                    <span>合计：</span>\n                    <span class="pay-price">￥0</span>\n                </div>\n                <a href="###" class="pay-btn">\n                    支付\n                </a>\n            </div>\n        </div>\n        <div class="collection-alert">\n        <p>收藏成功~感谢您对该商品的支持！</p>\n    </div>\n    <div class="del-alert">\n        <p>您确定要删除这个商品项吗？</p>\n        <a href="###">取消</a>\n        <a href="###">确定</a>\n    </div>',t="");var r=c.querySelector(".collection-alert"),d=c.querySelector(".del-alert"),n=d.querySelectorAll("a")[1],i=d.querySelectorAll("a")[0],p=c.querySelectorAll(".check-shop"),u=c.querySelectorAll(".check-i"),v=c.querySelectorAll(".check-all"),h=c.querySelector(".pay-count"),g=c.querySelector(".pay-price");function y(e,a){$.ajax({type:"get",url:"../api/updatecount.php",dataType:"json",data:{oid:$(e).attr("data-id"),count:a},success:function(e){}})}function f(){for(var e=Array.prototype.every.call(p,function(e){return e.checked}),a=0;a<v.length;a++)v[a].checked=e}function k(){var e=c.querySelectorAll(".check-i"),n=0,t=0;e.forEach(function(a){if(a.checked)for(var e=0;e<l.data.length;e++)l.data[e].goods.some(function(e){a.parentNode.dataset.id==e.id&&(n+=e.count,t+=e.price*e.count)})}),h.innerText=n,g.innerText="￥"+t.toFixed(1)}c.addEventListener("click",function(e){if("collection"==e.target.className)r.style.display="block",setTimeout(function(){r.style.display="none"},1e3);else if("del"==e.target.className)d.style.display="block",o=e.target.parentNode.parentNode;else if("add"==e.target.className)!function(e){var a=e.parentNode.parentNode.parentNode,n=a.querySelector(".count-num"),t=a.querySelector(".goods-sum p"),c=a.querySelector(".goods-price"),s=a.dataset.id;n.value=parseInt(n.value)+1,y(a,n.value),t.innerHTML="￥"+(n.value*c.innerText.slice(1)).toFixed(1);for(var o=0;o<l.data.length;o++)l.data[o].goods.forEach(function(e,a){e.id==s&&(e.count=1*n.value)});k()}(e.target);else if("reduce"==e.target.className)!function(e){var a=e.parentNode.parentNode.parentNode,n=a.querySelector(".count-num"),t=a.querySelector(".goods-sum p"),c=a.querySelector(".goods-price"),s=a.dataset.id;n.value=parseInt(n.value)-1<=0?1:parseInt(n.value)-1,y(a,n.value),t.innerHTML="￥"+(n.value*c.innerText.slice(1)).toFixed(1);for(var o=0;o<l.data.length;o++)l.data[o].goods.forEach(function(e,a){e.id==s&&(e.count=1*n.value)});k()}(e.target);else if("check-all"==e.target.className){for(var a=0;a<p.length;a++)p[a].checked=e.target.checked;for(a=0;a<u.length;a++)u[a].checked=e.target.checked;for(a=0;a<v.length;a++)v[a].checked=e.target.checked;k()}else if("check-shop"==e.target.className){var n=e.target.parentNode.parentNode.parentNode.querySelectorAll(".check-i");for(a=0;a<n.length;a++)n[a].checked=e.target.checked;f(),k()}else if("check-i"==e.target.className){var t=e.target.parentNode.parentNode.parentNode,c=t.querySelectorAll(".check-i"),s=Array.prototype.every.call(c,function(e){return e.checked});t.querySelector(".check-shop").checked=s,f(),k()}}),n.addEventListener("click",function(){d.style.display="none",function(){var a=o.parentNode,t=o.dataset.id;$.ajax({type:"GET",url:"../api/delorder.php",data:{oid:t},dataType:"json",success:function(e){if(0==e.code){a.removeChild(o);for(var n=0;n<l.data.length;n++)l.data[n].goods.some(function(e,a){e.id==t&&l.data[n].goods.splice(a,1)})}else alert("删除失败!")}}),k()}()}),i.addEventListener("click",function(){d.style.display="none",o=null})};